<section class="banner_area d-flex align-items-center bg-light" style="min-height: 80vh; margin-top: 100px; padding: 80px;">
  <div class="container">
    <div class="row justify-content-center">
      
      <!-- Left Column: Search & Categories -->
      <div class="col-lg-6 mb-4">
        <div class="banner_content text-center p-5 shadow rounded bg-white h-100">
          <!-- Title -->
          <h2 class="mb-4 fw-bold text-primary">Browse Poem Categories</h2>
          <p class="text-muted mb-4">Discover poems that resonate with your interests.</p>

          <!-- Search Bar -->
          <!-- Search Bar -->
<form id="searchForm" class="d-flex justify-content-center mb-4 position-relative">
  <input 
    id="searchInput"
    class="form-control me-2 shadow-sm"
    type="search"
    placeholder="Search poems or categories by words..."
    style="max-width: 350px; font-size: 0.95rem; padding: 10px;">
  <button class="btn btn-primary px-4 shadow-sm" type="submit">Search</button>

  <!-- Autosuggestions -->
  <ul id="suggestions" class="list-group position-absolute w-100 mt-5 shadow-sm" style="max-width: 350px; display: none; z-index: 1000;"></ul>
</form>


          <!-- Category List -->
          <div class="category-list">
            <ul class="list-group list-group-flush text-start mx-auto shadow-sm rounded" style="max-width: 350px;">
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Politics" class="category-link">Politics and Nation Building</a>
                <span class="badge bg-primary rounded-pill">12</span>
              </li>
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Woman" class="category-link">Mother (Woman)</a>
                <span class="badge bg-success rounded-pill">8</span>
              </li>
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Man" class="category-link">Father (Man)</a>
                <span class="badge bg-info rounded-pill">15</span>
              </li>
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Love" class="category-link">Love</a>
                <span class="badge bg-warning rounded-pill">5</span>
              </li>
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Pains" class="category-link">Dealing with Trauma Pains</a>
                <span class="badge bg-dark rounded-pill">10</span>
              </li>
              <li class="list-group-item py-3 fw-semibold d-flex justify-content-between align-items-center">
                <a href="/api/poems/category?category=Dreams" class="category-link">Dreams</a>
                <span class="badge bg-secondary rounded-pill">7</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

    
    <!-- Results Section -->
<div id="poemResults" class="mt-4"></div>

  </div>
</section>
  <!--================End Home Banner Area =================-->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>

<script>
const API_URL = "http://localhost:3008/api/poems";
const searchInput = document.getElementById("searchInput");
const suggestionsBox = document.getElementById("suggestions");

// ðŸ”¹ Live autosuggestions while typing
searchInput.addEventListener("input", async () => {
  const query = searchInput.value.trim();
  if (query.length < 2) {
    suggestionsBox.style.display = "none";
    return;
  }
  try {
    const res = await fetch(`${API_URL}/search?q=${encodeURIComponent(query)}`);
    const poems = await res.json();
    if (poems.length > 0) {
      suggestionsBox.innerHTML = poems
        .map(p => `
          <li class="list-group-item suggestion-item" data-id="${p._id}" style="cursor:pointer;">
            <strong>${p.title}</strong> <small class="text-muted">by ${p.author || "Unknown"}</small>
          </li>
        `).join("");
      suggestionsBox.style.display = "block";

      // Click â†’ go to poem page
      document.querySelectorAll(".suggestion-item").forEach(item => {
        item.addEventListener("click", () => {
          const id = item.getAttribute("data-id");
          window.location.href = `/api/poems/${id}`;
 // ðŸ”¹ navigate dynamically
        });
      });

    } else {
      suggestionsBox.style.display = "none";
    }
  } catch (err) {
    console.error("Autosuggest error:", err);
  }
});

// ðŸ”¹ Handle search form submit (full search results)
document.getElementById("searchForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const query = searchInput.value.trim();
  if (query) {
    try {
      const res = await fetch(`${API_URL}/search?q=${encodeURIComponent(query)}`);
      const poems = await res.json();
      renderPoems(poems);
      suggestionsBox.style.display = "none";
    } catch (error) {
      document.getElementById("poemResults").innerHTML =
        `<div class="alert alert-warning">Error fetching poems. Please try again.</div>`;
    }
  }
});

// ðŸ”¹ Render poems in results
function renderPoems(poems) {
  const container = document.getElementById("poemResults");
  if (!poems || poems.length === 0) {
    container.innerHTML = `<div class="alert alert-info">No poems found.</div>`;
    return;
  }
  container.innerHTML = poems.map(poem => `
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title text-primary">
          <a href="/poem/${poem._id}" style="text-decoration:none;">${poem.title}</a>
        </h5>
        <h6 class="text-muted">${poem.author || "Unknown Author"}</h6>
        <p class="card-text">${poem.content.substring(0, 150)}${poem.content.length > 150 ? "..." : ""}</p>
        <span class="badge bg-secondary">${poem.category}</span>
        <p class="text-muted mt-2"><small>Posted on ${new Date(poem.createdAt).toLocaleDateString()}</small></p>
      </div>
    </div>
  `).join("");
}
</script>
